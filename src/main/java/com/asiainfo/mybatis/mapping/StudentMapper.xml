<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.asiainfo.mybatis.dao.StudentMapper">

	<resultMap type="com.asiainfo.mybatis.model.Student" id="studentmap">
		<id column="student_id" property="id"/>
		<result column="student_name" property="name"/>
		<result column="student_sex" property="sex"/>
		<association property="clazz" javaType="com.asiainfo.mybatis.model.Clazz">
			<id property="id" column="clazz_id"/>
			<result property="name" column="clazz_name"/>
		</association>
	</resultMap>
	
	<sql id="Base_Column_List" >
		s.id 	as student_id,
		s.name 	as student_name,
		s.sex	as student_sex,
		s.clazz_id	as student_clazz,
		c.id	as clazz_id,
		c.name	as clazz_name
	</sql>
	
	<select id="getStudent" parameterType="java.lang.String" resultMap="studentmap">
		select 
		<include refid="Base_Column_List" />
		from student s 
			left outer join clazz c on s.clazz_id=c.id 
		where s.id=#{id}
	</select>
	
	<select id="getAll" resultMap="studentmap">
		select 
		<include refid="Base_Column_List" />
		from student s 
			left outer join clazz c on s.clazz_id=c.id 
	</select>
	
	<insert id="save" parameterType="com.asiainfo.mybatis.model.Student" >
	    insert into student
	    <trim prefix="(" suffix=")" suffixOverrides="," >
	    	<if test="1==1" >
	    		id,
	    	</if>
	    	<if test="1==1" >
	    		name,
	    	</if>
	    	<if test="1==1" >
	    		sex,
	    	</if>
	    	<if test="clazz!=null" >
	    		clazz_id,
	    	</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides="," >
			<if test="1==1" >
	    		#{id},
	    	</if>
	    	<if test="1==1" >
	    		#{name},
	    	</if>
	    	<if test="1==1" >
	    		#{sex},
	    	</if>
	    	<if test="clazz!=null" >
	    		#{clazz.id},
	    	</if>
	    </trim>
	</insert>
	
	<update id="update" parameterType="com.asiainfo.mybatis.model.Student">
	    update student set 
	    	name=#{name}, 
	    	sex=#{sex}
	    	<if test="clazz!=null" >
	    		,clazz_id=#{clazz.id} 
	    	</if>
	    where id=#{id}
	</update>
	
	<delete id="delete" parameterType="java.lang.String">
	    delete from student where id=#{id}
	</delete>
</mapper>